<!DOCTYPE html>

<head>
</head>

<body>
    <h2>Laboratorium 2</h2>
    <canvas id="canvas_element" width="800px" height="600px" style="border: 1px solid;"></canvas>
    <script>
        const detectCollisions = (cx, cy, radius, rx, ry, rw, rh) => {
            let testX = cx;
            let testY = cy;

            if (cx < rx) testX = rx;
            else if (cx > rx + rw) testX = rx + rw;
            if (cy < ry) testY = ry;
            else if (cy > ry + rh) testY = ry + rh;

            let distX = cx - testX;
            let distY = cy - testY;
            let distance = Math.sqrt((distX * distX) + (distY * distY));
            return distance <= radius;
        }
        async function run_animation() {
            const width = 100;
            const height = 50;
            const block_xy = [];

            const canv = document.querySelector('#canvas_element');
            const ctx = canv.getContext("2d");
            ctx.fillStyle = '#ffffff';
            ctx.clearRect(0, 0, canv.width, canv.height);

            ctx.fillStyle = '#000000';
            for (let i = 0; i < 5; ++i) {
                const [x, y] = [100 + i * width, 200 + i * height];
                ctx.beginPath();
                ctx.rect(x, y, width, height);
                ctx.fill();
                block_xy.push([x, y]);
                await new Promise(x => setTimeout(x, 1000));
            }

            let [ball_x, ball_y, ball_r] = [150, 100, 20];
            while (ball_y < canv.height) {
                ctx.beginPath();
                ctx.fillStyle = "#ffffff";
                ctx.arc(ball_x, ball_y, ball_r + 1, 0, Math.PI * 2);
                ctx.fill();

                let flag = 0;
                for (const [x, y] of block_xy)
                    flag += detectCollisions(ball_x, ball_y, ball_r + 2, x, y, width, height);
                flag === 0 ? ball_y += 2 : ball_x += 1;

                ctx.beginPath();
                ctx.arc(ball_x, ball_y, ball_r, 0, Math.PI * 2);
                ctx.fillStyle = "#0095DD";
                ctx.fill();
                await new Promise(x => setTimeout(x, 10));
            }

            return 0;
        }

        (async function () {
            for (; ;)
                await run_animation();

        })();
    </script>
</body>

</html>